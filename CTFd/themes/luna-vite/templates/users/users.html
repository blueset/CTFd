{% extends "templates/framed.html" %}
{% from "macros/input.html" import wtf_input_field %}

{% block title %}Users{% endblock %}
{% block subtitle %}{% if q and field %}Search result{% else %}Users list{% endif %}{% endblock %}

{% block framedContent %}
<div class="frameContentWrapper">
  
  {% with form = Forms.users.PublicUserSearchForm(field=field, q=q) %}
    <form method="GET" class="searchForm">
      <input type="hidden" name="field" value="name">
      {{ wtf_input_field(form.q(class="form-control w-100", placeholder="Search")) }}
      <button type="submit" class="button roundIconButton">
        <iconify-icon icon="material-symbols:search" class="" inline></iconify-icon>
      </button>
    </form>
  {% endwith %}

  {% if users.total == 0 %}
    <div class="warning" style="justify-content: center;">No user found.</div>
  {% else %}
    <div class="grid">
      {% for user in users.items %}
        {% if scores_visible() %}
        <a href="{{ url_for('users.public', user_id=user.id) }}" class="gridCell">
        {% else %}
        <div class="gridItem">
        {% endif %}
          <div class="cellHeader">{{ user.name | truncate(50) }}</div>
          <div class="cellBody">
            <img src="https://ui-avatars.com/api/?background=random&name={{ user.name | urlencode }}" class="cellBodyIcon">
          </div>
          <div class="cellFooter">
            {% if user.team %}{{user.team.name | truncate(50) }}{% else %}<em>No team</em>{% endif %}
          </div>
        {% if scores_visible() %}</a>{% else %}</div>{% endif %}
      {% endfor %}
    </div>
  {% endif %}

  {% if users.pages > 1 %}
  <div class="pageCounter">
    {% for page in range(1, users.pages + 1) %}
    <span class="pageCounterDot {% if users.page == page %}active{% endif %}"></span>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% if users.pages > 1 %}
  {% if users.page != 1 %}
  <a class="pageIndicator previousPage" href="{{ prev_page }}">
      <img src="{{ url_for('views.themes', path='img/left-chevron.svg') }}" alt="Previous page" />
    </a>
  {% endif %}

  {% if users.next_num %}
    <a class="pageIndicator nextPage" href="{{ next_page }}">
      <img src="{{ url_for('views.themes', path='img/right-chevron.svg') }}" alt="Next page" />
    </a>
  {% endif %}
{% endif %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  {#{ Assets.js("assets/js/users/list.js") }#}
{% endblock %}
