{% extends "templates/plain.html" %}

{% block plainContent %}
<div id="challengesWrapper" x-data="ChallengeBoard" @load-challenges.window="loadChallengesEvt()"
@load-challenge.window="loadChallengeEvt($event.detail)" @collapse-challenge.window="collapseChallengeEvt()">
  <div class="titleContainer">
      <button class="button iconButton" id="backButton">
          <iconify-icon icon="icon-park-solid:back"></iconify-icon>
      </button>
      <div class="titleGroup">
          <h1 class="title">Challenges</h1>
          <h2 class="subtitle"><span>Challenges list</span></h2>
      </div>
  </div>
  <div class="tabs">
      <div class="filler"></div>
      <button :class="{'tab': true, 'active': category === null}" @click="setCategory(null)">All</button>
      <template x-for="(cat, idx) in getCategoryWithIcons()" :key="idx">
        <button class="tab" :class="{'tab': true, 'active': category === cat[0]}" @click="setCategory(cat[0])">
          <img :src="cat[1]" :alt="cat[0]" x-show="cat[1] !== null" />
          <span x-text="cat[0]" x-show="cat[1] === null"></span>
        </button>
      </template>
      <div class="filler"></div>
  </div>

  <div id="challengesListWrapper">
    <div id="challengesList" x-ref="listNode">
      <div x-show="challenges.length < 1" class="noChallenge">No challenges found.</div>
      <template x-for="(ch, idx) in repeatArray(filteredChallenges, repeatTimes)" :key="`a${idx}`">
        <div class="challengeItem" @click="selectChallenge(idx % filteredChallenges.length, $event.target)">
        {% include 'components/challengeListEntry.html' %}
        </div>
      </template>
      <template x-for="(ch, idx) in filteredChallenges" :key="`c${idx}`">
        <div :data-is-center="idx" :data-index="idx" :class="{ 'challengeItem': true, 'selected': ch.id === selectedId }" @click="selectChallenge(idx, $event.target)">
        {% include 'components/challengeListEntry.html' %}
        </div>
      </template>
      <template x-for="(ch, idx) in repeatArray(filteredChallenges, repeatTimes)" :key="`b${idx}`">
        <div class="challengeItem" @click="selectChallenge(idx % filteredChallenges.length, $event.target)">
        {% include 'components/challengeListEntry.html' %}
        </div>
      </template>
    </div>
    <div x-show="!loaded" class="loadingWrapper">{% include "components/loading.html" %}</div>
    {% if infos or errors %}
      <div id="challengeContentErrors">
        {% include "components/errors.html" %}
      </div>
    {% endif %}
  </div>

  <div id="challengesContentWrapper" :class="{'expanded': selectedId !== null}" x-html="$store.challenge.data.view">
  </div>
  <div class="loadingWrapper" x-show="$store.challenge.loading">{% include "components/loading.html" %}</div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  window.tagImages = {
    "misc": "{{ url_for('views.themes', path='img/categories/Misc.svg') }}",
    "crypto": "{{ url_for('views.themes', path='img/categories/Crypto.svg') }}",
    "forensics": "{{ url_for('views.themes', path='img/categories/Forensics.svg') }}",
    "reverse": "{{ url_for('views.themes', path='img/categories/Reverse.svg') }}",
    "pwn": "{{ url_for('views.themes', path='img/categories/Pwn.svg') }}",
    "ppc": "{{ url_for('views.themes', path='img/categories/PPC.png') }}",
    "web": "{{ url_for('views.themes', path='img/categories/Web.svg') }}",
  };
  window.rankIcons = [
    "{{ url_for('views.themes', path='img/ranks/rank-1.svg') }}",
    "{{ url_for('views.themes', path='img/ranks/rank-2.svg') }}",
    "{{ url_for('views.themes', path='img/ranks/rank-3.svg') }}",
  ];
</script>
{{ Assets.js("assets/js/challenges.js") }}
{% endblock %}