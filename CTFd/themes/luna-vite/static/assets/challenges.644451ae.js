import{m as a}from"./module.esm.860ebcbd.js";import{N as x,i as b,C as g}from"./base.c80997e6.js";import{c as I,d as m}from"./duration.e8546e45.js";import{a as k}from"./clipboard.f5fd11cd.js";import"./notificationCounter.4f4e1e9f.js";import"./tippy.esm.6ff6f36c.js";var $={exports:{}};(function(e,t){(function(s,l){e.exports=l()})(I,function(){return function(s,l,i){i.updateLocale=function(n,c){var r=i.Ls[n];if(r)return(c?Object.keys(c):[]).forEach(function(h){r[h]=c[h]}),r}}})})($);var N=$.exports;const C=100;function u(e,t){e.scrollTop+=t}function v(){if(performance.now()-window.lastClick<500)return;const e=document.getElementById("challengesList"),t=[...document.querySelectorAll("[data-is-center]")];var s=t,l=!1;document.querySelectorAll(".challengeItem.selected").length&&(l=!0,s=[...document.querySelectorAll(".challengeItem.selected")]);const i=Math.min(...t.map(f=>f.offsetTop)),n=Math.max(...t.map(f=>f.offsetTop+f.offsetHeight)),c=Math.min(...s.map(f=>f.offsetTop)),r=Math.max(...s.map(f=>f.offsetTop+f.offsetHeight)),h=e.scrollTop,d=e.scrollTop+e.clientHeight,p=e.clientHeight,o=n-i,w=(h+d)/2;if(!l)n<w?u(e,-o):i>w&&u(e,o);else if(r<h&&c+o>d||c>d&&r-o<h)n<w?u(e,-o):i>w&&u(e,o);else if(r<h&&c+o<=d){var y=Math.max(Math.floor(p/o),1)*o;u(e,-y)}else if(c>d&&r-o>=h){var y=Math.max(Math.floor(p/o),1)*o;u(e,y)}}const H=!!/Windows NT .* rv:([^\)]+)\) Gecko\/\d{8}/.test(navigator.userAgent);H&&(v=_.debounce(v,150));function E(e){let t=()=>{let s,l=localStorage;return e.interceptor((i,n,c,r,h)=>{let d=s||`_x_${r}`,p=A(d,l)?L(d,l):i;return c(p),e.effect(()=>{let o=n();B(d,o,l),c(o)}),p},i=>{i.as=n=>(s=n,i),i.using=n=>(l=n,i)})};Object.defineProperty(e,"$persist",{get:()=>t()}),e.magic("persist",t)}function A(e,t){return t.getItem(e)!==null}function L(e,t){return JSON.parse(t.getItem(e,t))}function B(e,t,s){s.setItem(e,JSON.stringify(t))}var q=E;a.plugin(q);m.extend(N);m.updateLocale("en",{relativeTime:{future:"+%s",past:"-%s",s:"%s<small>s</small>",m:"1<small>min</small>",mm:"%d<small>mins</small>",h:"1<small>hr</small>",hh:"%d<small>hrs</small>",d:"1<small>d</small>",dd:"%d<small>d</small>",M:"1<small>mth</small>",MM:"%d<small>mths</small>",y:"1<small>yr</small>",yy:"%d<small>yrs</small>"}});const T={[window.init.themeSettings.tag_difficulty_1]:1,[window.init.themeSettings.tag_difficulty_2]:2,[window.init.themeSettings.tag_difficulty_3]:3,[window.init.themeSettings.tag_difficulty_4]:4,[window.init.themeSettings.tag_difficulty_5]:5},M={[window.init.themeSettings.cat_name_misc]:"#dbdbdb",[window.init.themeSettings.cat_name_crypto]:"#cbfdc6",[window.init.themeSettings.cat_name_forensics]:"#c6d8fd",[window.init.themeSettings.cat_name_rev]:"#e9c6fd",[window.init.themeSettings.cat_name_pwn]:"#fde2c6",[window.init.themeSettings.cat_name_ppc]:"#f8fdc6",[window.init.themeSettings.cat_name_web]:"#c6cbfd"},O={Difficulty(e,t){return(e.difficulty||1)-(t.difficulty||1)||e.name.localeCompare(t.name)},Score(e,t){return(e.value||0)-(t.value||0)||e.name.localeCompare(t.name)},Solves(e,t){return(e.solves||0)-(t.solves||0)||e.name.localeCompare(t.name)},Name(e,t){return e.name.localeCompare(t.name)}},D=e=>e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");function S(e){let s=new DOMParser().parseFromString(e,"text/html");return s.querySelectorAll('a[href*="://"]').forEach(i=>{i.setAttribute("target","_blank")}),s.documentElement.outerHTML}window.Alpine=a;const U=new x({duration:0,dismissible:!0,ripple:!0,position:{x:"left",y:"top"},types:[{type:"info",backgroundColor:"#5CC9BB"},{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}]});a.store("challenge",{data:{view:""},loading:!1});a.data("Challenge",()=>({id:null,next_id:null,submission:"",tab:null,solves:null,submitting:!1,hints:{},init(){b(this.$refs.solversModal,[],[this.$refs.solversModalClose]),document.querySelectorAll(".hintModal").forEach(e=>{console.log(e),this.hints[parseInt(e.dataset.hintId)]={id:null,html:null};const t=e.querySelector("button");b(e,[],[t])})},async showSolves(){this.solves=await g.pages.challenge.loadSolves(this.id),this.solves.forEach((e,t)=>(e.timeDiff="",t===0&&window.init.start?e.timeDiff=m.duration(m(e.date).diff(m.unix(window.init.start))).humanize(!0):t>0&&(e.timeDiff=m.duration(m(e.date).diff(m(this.solves[t-1].date))).humanize(!0)),e.date=m(e.date).format("D MMM YYYY, HH:mm:ss"),e)),this.$refs.solversModal.showModal()},getNextId(){return a.store("challenge").data.next_id},async nextChallenge(){Modal.getOrCreateInstance("[x-ref='challengeWindow']").hide(),this.$dispatch("load-challenge",this.getNextId())},async submitChallenge(){this.submitting=!0;const e=await g.pages.challenge.submitChallenge(this.id,this.submission);this.submitting=!1,U.open({type:e.data.status==="correct"?"success":e.data.status==="incorrect"?"error":"info",message:`<code>${D(this.submission)}</code><br>${e.data.message}`}),e.data.status==="correct"&&(this.submission=""),this.$dispatch("load-challenges")},copyText(e){k(e,this.$refs.connectionBox)},collapse(){this.$dispatch("collapse-challenge")},async showHint(e,t){console.log("showHint",e,t);const s=this.$refs[`hintDialog${e}`];if(t){let i=(await g.pages.challenge.loadHint(e)).data,n='<div class="warning">Hint is not available.</div>';if(i.content)n=S(i.html);else if(await g.pages.challenge.displayUnlock(e)){let r=await g.pages.challenge.loadUnlock(e);if(r.success){let d=(await g.pages.challenge.loadHint(e)).data;n=S(d.html)}else{g._functions.challenge.displayUnlockError(r);return}}this.hints[e]={id:e,html:n}}s.showModal()}}));a.data("ChallengeBoard",function(){return{loaded:!1,challenges:[],filteredChallenges:[],selectedId:null,category:null,oobe:this.$persist(!0),sortOrder:this.$persist("Difficulty"),filterCondition:this.$persist("All"),loopHighlight:this.$persist(!1),highContrast:this.$persist(!1),repeatTimes:1,async init(){b(this.$refs.settingsModal,[],[this.$refs.settingsModalClose]);const e=window.location.hash;window.lastClick=0,await this.loadChallenges(),this.loaded=!0,await a.nextTick(),await this.setCategory(null),this.$refs.listNode.addEventListener("scroll",()=>{window.requestAnimationFrame(v)},!1),e.length>0&&await this.loadChalByName(decodeURIComponent(e.substring(1))),this.oobe&&this.$refs.oobeModal.showModal()},async loadChalByName(e){let t=e.lastIndexOf("-"),s=[e.slice(0,t),e.slice(t+1)],l=parseInt(s[1]),i=this.challenges.findIndex(n=>n.id===l);await this.selectChallenge(i,null)},getCategories(){const e=[];this.challenges.forEach(t=>{const{category:s}=t;e.includes(s)||e.push(s)});try{const t=g.config.themeSettings.challenge_category_order;if(t){const s=new Function(`return (${t})`);e.sort(s())}}catch(t){console.log("Error running challenge_category_order function"),console.log(t)}return e},getCategoryWithIcons(){const e={};return e[window.init.themeSettings.cat_name_misc]=window.tagImages.misc,e[window.init.themeSettings.cat_name_crypto]=window.tagImages.crypto,e[window.init.themeSettings.cat_name_forensics]=window.tagImages.forensics,e[window.init.themeSettings.cat_name_rev]=window.tagImages.reverse,e[window.init.themeSettings.cat_name_pwn]=window.tagImages.pwn,e[window.init.themeSettings.cat_name_ppc]=window.tagImages.ppc,e[window.init.themeSettings.cat_name_web]=window.tagImages.web,this.getCategories().map(t=>[t,e[t]||null])},getChallenges(e){let t=this.challenges;e&&(t=this.challenges.filter(s=>s.category===e)),this.filterCondition==="Unsolved"?t=t.filter(s=>!s.solved_by_me):this.filterCondition==="Solved"&&(t=t.filter(s=>s.solved_by_me));try{t.sort(O[this.sortOrder])}catch(s){console.log("Error running challenge_order function"),console.log(s)}return t},async loadChallenges(){console.log("Loading challenges..."),this.challenges=(await g.pages.challenges.getChallenges()).map(this.addChallengeProperties)},async loadChallenge(e){e===null?(a.store("challenge").data.view="",this.setColor(null)):(a.store("challenge").data.view="",a.store("challenge").loading=!0,await g.pages.challenge.displayChallenge(e,t=>{t.data.view=S(t.data.view),a.store("challenge").loading=!1,a.store("challenge").data=t.data,this.setColor(t.data.category),a.nextTick(()=>{})}))},addChallengeProperties(e){const t=e.tags.map(l=>l.value),s=[];return e.difficulty=1,t.forEach(l=>{T[l]?e.difficulty=T[l]:s.push(l)}),e.label=s.join(", "),e},async setCategory(e){this.category===e&&this.filteredChallenges.length>0||(this.category=e,history.replaceState(void 0,void 0,"#"),this.loadChallenge(null),this.filteredChallenges=this.getChallenges(e),this.repeatTimes=this.filteredChallenges.length===0?0:Math.ceil(window.screen.height/(this.filteredChallenges.length*C)),this.selectedId=null,await a.nextTick(),this.centerNode(0))},async selectChallenge(e,t){const s=this.filteredChallenges[e];if(t&&(t=t.closest(".challengeItem")),this.selectedId==s.id){this.centerNode(e,t);return}this.selectedId=s.id,history.replaceState(void 0,void 0,`#${s.name.replace(/ /g,"-")}-${s.id}`),this.centerNode(e,t),await this.loadChallenge(s.id)},async loadChallengeEvt(e){const t=this.challenges.findIndex(s=>s.id===e);await this.setCategory(null),await this.selectChallenge(t)},async loadChallengesEvt(){const e=this.selectedId||null;await this.loadChallenges(),this.filteredChallenges=this.getChallenges(this.category),this.repeatTimes=this.filteredChallenges.length===0?0:Math.ceil(window.screen.height/(this.filteredChallenges.length*C)),e!==null&&await this.loadChallenge(e)},collapseChallengeEvt(){this.selectedId=null,history.replaceState(void 0,void 0,"#"),setTimeout(()=>this.loadChallenge(null),500)},async refreshSortFilter(){this.filteredChallenges=this.getChallenges(this.category);var e=null;this.selectedId!==null&&(e=this.filteredChallenges.findIndex(t=>t.id===this.selectedId),e<0&&(e=null)),this.repeatTimes=this.filteredChallenges.length===0?0:Math.ceil(window.screen.height/(this.filteredChallenges.length*C)),await a.nextTick(),e!==null&&this.centerNode(e)},repeatArray(e,t){return Array.from({length:t},()=>e).flat()},centerNode(e,t){const s=this.$refs.listNode,l=s.querySelector(`[data-is-center="${e}"]`);if(l!==null)if(t){if(!t.isEqualNode(l)){var i=t.offsetTop-s.scrollTop;s.scrollTop=l.offsetTop-i}s.scrollTo({top:l.offsetTop-(s.clientHeight-l.clientHeight)/2,behavior:"smooth"})}else s.scrollTop=l.offsetTop-(s.clientHeight-l.clientHeight)/2},setColor(e){var t="";M[e]&&(t=`linear-gradient(to bottom, #dddddd, ${M[e]})`),document.documentElement.style.setProperty("--background-gradient",t)},oobeUpdate(e){this.oobe=!1,this.loopHighlight=e;const t=this.$refs.oobeModal,s=()=>{t.classList.remove("hide"),t.close(),t.removeEventListener("webkitAnimationEnd",s,!1)};t.classList.add("hide"),t.addEventListener("webkitAnimationEnd",s,!1)}}});a.start();
